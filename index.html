<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Elementos Materiais</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        header { background: #556B2F; padding: 10px 20px; color: white; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        header img.logo { height: 100px; margin-bottom: 10px; }
        header h1 { margin: 0; font-size: 28px; text-align: center; }
        nav { background: #6B8E23; padding: 10px; text-align: center; }
        nav a { color: white; margin: 0 15px; text-decoration: none; font-weight: bold; cursor: pointer; }
        .search-bar { padding: 20px; text-align: center; }
        .search-bar input { width: 50%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; }
        .product-card { background: white; border: 1px solid #ddd; border-radius: 8px; margin: 15px; padding: 15px; width: 250px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; display: flex; flex-direction: column; justify-content: space-between; }
        .product-card img { max-width: 100%; height: 180px; object-fit: contain; margin-bottom: 10px; cursor: pointer; }
        .product-card h3 { font-size: 1.2em; margin: 10px 0; }
        .product-card p { font-size: 0.9em; color: #555; flex-grow: 1; }
        .product-card .price { font-size: 1.3em; color: #6B8E23; font-weight: bold; margin: 10px 0; }
        .product-card button { background: #556B2F; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 1em; transition: background 0.3s ease; }
        .product-card button:hover { background: #6B8E23; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 10px; text-align: center; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; position: absolute; top: 10px; right: 20px; cursor: pointer; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
        #cart-modal .modal-content { max-width: 600px; }
        #cart-items { list-style: none; padding: 0; }
        #cart-items li { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #eee; }
        #cart-items li:last-child { border-bottom: none; }
        #cart-total { font-size: 1.2em; font-weight: bold; margin-top: 15px; text-align: right; }
        #checkout-button { background: #4CAF50; margin-top: 20px; }
        #checkout-button:hover { background: #45a049; }
        .quantity-controls button { background: #f0f0f0; color: #333; border: 1px solid #ccc; padding: 3px 8px; border-radius: 3px; cursor: pointer; }
        .quantity-controls span { margin: 0 8px; font-weight: bold; }
        #admin-panel { padding: 20px; max-width: 800px; margin: 20px auto; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #admin-panel h2 { text-align: center; color: #556B2F; }
        #admin-controls button { background: #556B2F; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        #admin-controls button:hover { background: #6B8E23; }
        #product-upload-form { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        #product-upload-form input[type="file"] { margin-bottom: 10px; }
        #product-upload-form button { background: #4CAF50; }
        #product-upload-form button:hover { background: #45a049; }
        #admin-product-list { margin-top: 20px; }
        #admin-product-list table { width: 100%; border-collapse: collapse; }
        #admin-product-list th, #admin-product-list td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #admin-product-list th { background-color: #f2f2f2; }
        .admin-product-actions button { background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-right: 5px; }
        .admin-product-actions button:hover { background: #da190b; }
        #login-modal .modal-content { max-width: 300px; padding: 30px; }
        #login-form input { width: calc(100% - 22px); padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; }
        #login-form button { width: 100%; background: #556B2F; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        #login-form button:hover { background: #6B8E23; }
        .category-filter-buttons { text-align: center; padding: 10px; }
        .category-filter-buttons button { background: #ddd; border: 1px solid #ccc; padding: 8px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .category-filter-buttons button.active { background: #6B8E23; color: white; }
        #product-details-modal .modal-content { max-width: 700px; text-align: left; }
        #product-details-modal img { max-width: 100%; height: auto; display: block; margin: 0 auto 15px; }
        #product-details-modal h2 { text-align: center; color: #556B2F; margin-bottom: 10px; }
        #product-details-modal p { margin-bottom: 8px; line-height: 1.5; }
        #product-details-modal .detail-price { font-size: 1.5em; font-weight: bold; color: #6B8E23; text-align: center; margin-top: 20px; }
        .category-filter-buttons button:hover { background-color: #c0c0c0; }

        /* Modal para zoom da imagem */
        #image-modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            padding-top: 60px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }
        #image-modal .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            background-color: transparent; /* Remove background for image modal */
            border: none; /* Remove border */
            padding: 0; /* Remove padding */
        }
        #modal-image {
            width: 100%;
            height: auto;
            display: block;
            margin: auto;
        }
        #image-modal .close-button {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }
        #image-modal .close-button:hover,
        #image-modal .close-button:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }
        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .search-bar input { width: 80%; }
            .product-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
            .product-card { width: 180px; }
            header h1 { font-size: 22px; }
            nav a { margin: 0 8px; font-size: 0.9em; }
            #admin-panel { padding: 10px; }
            #admin-product-list th, #admin-product-list td { padding: 5px; font-size: 0.8em; }
            .modal-content { width: 90%; }
        }
    </style>
</head>
<body>
    <header>
        <img src="https://i.imgur.com/vHq0L9J.png" alt="Elementos Materiais Logo" class="logo">
        <h1>Elementos Materiais</h1>
    </header>

    <nav>
        <a onclick="mostrarPainel('produtos')">Produtos</a>
        <a onclick="mostrarPainel('ofertas')">Ofertas</a>
        <a onclick="mostrarPainel('carrinho')">Carrinho (<span id="cart-count">0</span>)</a>
        <a onclick="abrirModalLogin()">Admin</a>
    </nav>

    <div class="search-bar">
        <input type="text" id="search-input" placeholder="Buscar produtos...">
    </div>

    <div class="category-filter-buttons" id="category-filters">
        </div>

    <div id="produtos-panel" class="panel active">
        <div class="product-grid" id="product-list">
            </div>
    </div>

    <div id="ofertas-panel" class="panel">
        <div class="product-grid" id="offer-list">
            </div>
    </div>

    <div id="carrinho-panel" class="panel">
        <div class="modal" id="cart-modal">
            <div class="modal-content">
                <span class="close-button" onclick="fecharModal('cart-modal')">&times;</span>
                <h2>Seu Carrinho</h2>
                <ul id="cart-items">
                    </ul>
                <p id="cart-total">Total: R$ 0.00</p>
                <button id="checkout-button" onclick="checkout()">Finalizar Compra</button>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="panel">
        <h2>Painel de Administração</h2>
        <div id="admin-controls">
            <button onclick="document.getElementById('product-upload-form').style.display = 'block';">Importar Produtos (Excel/JSON)</button>
            <button onclick="excluirTodosOsProdutos()">Excluir Todos os Produtos</button>
            <button onclick="saveCurrentHtml()">Salvar HTML Atual</button>
        </div>

        <div id="product-upload-form" style="display:none; margin-top: 20px;">
            <h3>Importar Produtos</h3>
            <input type="file" id="excel-file-input" accept=".xlsx, .xls, .json">
            <button onclick="handleFileUpload()">Carregar Produtos</button>
        </div>

        <h3>Lista de Produtos (Admin)</h3>
        <div id="admin-product-list">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Preço</th>
                        <th>Menu</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="admin-product-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="fecharModal('login-modal')">&times;</span>
            <h2>Login Admin</h2>
            <form id="login-form">
                <input type="password" id="admin-password" placeholder="Senha do Admin" required>
                <button type="submit">Entrar</button>
            </form>
        </div>
    </div>

    <div id="product-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="fecharModal('product-details-modal')">&times;</span>
            <img id="detail-image" src="" alt="Imagem do Produto">
            <h2 id="detail-name"></h2>
            <p><strong>Categoria:</strong> <span id="detail-category"></span></p>
            <p><strong>Descrição:</strong> <span id="detail-description"></span></p>
            <p class="detail-price" id="detail-price"></p>
            <button onclick="adicionarAoCarrinho(this.dataset.productId)" data-product-id="">Adicionar ao Carrinho</button>
        </div>
    </div>

    <div id="image-modal" class="modal" onclick="closeImageModal()">
        <span class="close-button" onclick="closeImageModal()">&times;</span>
        <img class="modal-content" id="modal-image">
    </div>

    <script>
        let produtosSalvos = []; // Array principal que armazena todos os produtos
        let carrinho = JSON.parse(localStorage.getItem('carrinho')) || {}; // Carrinho de compras

        const ADMIN_PASSWORD = "admin"; // Senha simples para o painel de administração

        function salvarProdutos() {
            localStorage.setItem('produtosSalvos', JSON.stringify(produtosSalvos));
            renderProducts();
            renderAdminProductList();
        }

        function salvarCarrinho() {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            renderCart();
        }

        function renderProducts(filter = 'todos', searchTerm = '') {
            const productList = document.getElementById('product-list');
            const offerList = document.getElementById('offer-list');
            
            // Limpa as listas existentes
            if (productList) productList.innerHTML = '';
            if (offerList) offerList.innerHTML = '';

            const filteredProducts = produtosSalvos.filter(product => {
                const matchesCategory = filter === 'todos' || product.categoria === filter;
                const matchesSearch = product.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      product.descricao.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${product.imagem}" alt="${product.nome}" onclick="openProductDetailsModal('${product.id}')">
                    <h3>${product.nome}</h3>
                    <p>${product.descricao}</p>
                    <p class="price">R$ ${product.valor.toFixed(2)}</p>
                    <button onclick="adicionarAoCarrinho('${product.id}')">Adicionar ao Carrinho</button>
                `;
                if (product.menu === 'produtos' && productList) {
                    productList.appendChild(card);
                } else if (product.menu === 'ofertas' && offerList) {
                    offerList.appendChild(card);
                }
            });

            // Se não houver produtos após o filtro, mostre uma mensagem
            if (productList && productList.children.length === 0 && filter !== 'ofertas') {
                productList.innerHTML = '<p>Nenhum produto encontrado nesta categoria ou busca.</p>';
            }
            if (offerList && offerList.children.length === 0 && filter !== 'produtos') {
                offerList.innerHTML = '<p>Nenhuma oferta encontrada nesta categoria ou busca.</p>';
            }
        }

        function renderCart() {
            const cartItemsList = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountElement = document.getElementById('cart-count');
            
            if (!cartItemsList || !cartTotalElement || !cartCountElement) return;

            cartItemsList.innerHTML = '';
            let total = 0;
            let itemCount = 0;

            for (const productId in carrinho) {
                const product = produtosSalvos.find(p => p.id === productId);
                if (product) {
                    const quantity = carrinho[productId];
                    const itemTotal = product.valor * quantity;
                    total += itemTotal;
                    itemCount += quantity;

                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span>${product.nome}</span>
                        <div class="quantity-controls">
                            <button onclick="diminuirQuantidade('${productId}')">-</button>
                            <span>${quantity}</span>
                            <button onclick="aumentarQuantidade('${productId}')">+</button>
                            <button onclick="removerDoCarrinho('${productId}')">Remover</button>
                        </div>
                        <span>R$ ${itemTotal.toFixed(2)}</span>
                    `;
                    cartItemsList.appendChild(listItem);
                }
            }

            cartTotalElement.textContent = `Total: R$ ${total.toFixed(2)}`;
            cartCountElement.textContent = itemCount;
        }

        function adicionarAoCarrinho(productId) {
            carrinho[productId] = (carrinho[productId] || 0) + 1;
            salvarCarrinho();
            alert('Produto adicionado ao carrinho!');
        }

        function diminuirQuantidade(productId) {
            if (carrinho[productId] > 1) {
                carrinho[productId]--;
            } else {
                delete carrinho[productId];
            }
            salvarCarrinho();
        }

        function aumentarQuantidade(productId) {
            carrinho[productId]++;
            salvarCarrinho();
        }

        function removerDoCarrinho(productId) {
            delete carrinho[productId];
            salvarCarrinho();
        }

        function checkout() {
            if (Object.keys(carrinho).length === 0) {
                alert('Seu carrinho está vazio!');
                return;
            }

            const mensagem = Object.keys(carrinho).map(productId => {
                const product = produtosSalvos.find(p => p.id === productId);
                const quantity = carrinho[productId];
                return `${product ? product.nome : 'Produto Desconhecido'} (x${quantity})`;
            }).join('\n');

            const total = Object.keys(carrinho).reduce((sum, productId) => {
                const product = produtosSalvos.find(p => p.id === productId);
                return sum + (product ? product.valor * carrinho[productId] : 0);
            }, 0);

            const whatsappMessage = `Olá! Gostaria de fazer o seguinte pedido:\n\n${mensagem}\n\nTotal: R$ ${total.toFixed(2)}`;
            const whatsappUrl = `https://wa.me/5527999999999?text=${encodeURIComponent(whatsappMessage)}`; // Substitua pelo seu número de WhatsApp
            window.open(whatsappUrl, '_blank');

            carrinho = {};
            salvarCarrinho();
            fecharModal('cart-modal');
            alert('Pedido enviado para o WhatsApp!');
        }

        function mostrarPainel(panelId) {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(panelId + '-panel').style.display = 'block';

            // Garante que o catálogo de produtos e ofertas é renderizado ao mudar para seus painéis
            if (panelId === 'produtos' || panelId === 'ofertas') {
                renderProducts(); // Isso renderiza ambos os painéis (produtos e ofertas)
            } else if (panelId === 'carrinho') {
                renderCart();
                abrirModal('cart-modal');
            } else if (panelId === 'admin') {
                // Checa se o usuário está logado como admin antes de mostrar o painel
                if (localStorage.getItem('isAdminLoggedIn') === 'true') {
                    renderAdminProductList();
                    document.getElementById('admin-panel').style.display = 'block';
                } else {
                    abrirModalLogin();
                }
            }
        }

        function abrirModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'flex';
        }

        function fecharModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }

        function abrirModalLogin() {
            abrirModal('login-modal');
        }

        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('isAdminLoggedIn', 'true');
                fecharModal('login-modal');
                mostrarPainel('admin');
                alert('Login de administrador bem-sucedido!');
            } else {
                alert('Senha incorreta.');
            }
            document.getElementById('admin-password').value = ''; // Limpa o campo da senha
        });

        // Event listener para a barra de busca
        document.getElementById('search-input').addEventListener('input', function(event) {
            const searchTerm = event.target.value;
            const currentPanel = document.querySelector('.panel.active').id.replace('-panel', '');
            if (currentPanel === 'produtos' || currentPanel === 'ofertas') {
                renderProducts(currentPanel, searchTerm);
            }
        });

        function renderAdminProductList() {
            const adminProductTableBody = document.getElementById('admin-product-table-body');
            if (!adminProductTableBody) return; // Garante que o elemento existe

            adminProductTableBody.innerHTML = '';
            produtosSalvos.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.nome}</td>
                    <td>R$ ${product.valor.toFixed(2)}</td>
                    <td>${product.menu}</td>
                    <td class="admin-product-actions">
                        <button onclick="editarProduto('${product.id}')">Editar</button>
                        <button onclick="deletarProduto('${product.id}')">Excluir</button>
                    </td>
                `;
                adminProductTableBody.appendChild(row);
            });
        }

        function editarProduto(productId) {
            alert('Funcionalidade de edição não implementada ainda.');
            // Implementação futura: Abrir um modal de edição com os dados do produto
        }

        function deletarProduto(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                produtosSalvos = produtosSalvos.filter(product => product.id !== productId);
                salvarProdutos();
                alert('Produto excluído com sucesso!');
            }
        }

        function handleFileUpload() {
            const fileInput = document.getElementById('excel-file-input');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecione um arquivo Excel ou JSON.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = e.target.result;
                let newProducts = [];

                if (file.name.endsWith('.json')) {
                    try {
                        const json = JSON.parse(data);
                        newProducts = json.map(row => ({
                            id: String(row.ID || Date.now().toString() + Math.random().toString(36).substring(2, 8)),
                            nome: String(row.nome || 'Sem Nome'), // Assumindo 'nome' no JSON
                            categoria: String(row.categoria || 'Geral'),
                            descricao: String(row.descricao || ''),
                            valor: parseFloat(row.valor) || 0, // Assumindo 'valor' no JSON
                            imagem: String(row.imagem_id || 'https://via.placeholder.com/150'), // Assumindo 'imagem_id' no JSON
                            menu: String(row.menu || 'produtos')
                        }));
                    } catch (jsonError) {
                        alert('Erro ao parsear arquivo JSON. Verifique o formato.');
                        console.error('Erro ao parsear JSON:', jsonError);
                        return;
                    }
                } else { // Assume Excel
                    const workbook = XLSX.read(data, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(sheet);

                    newProducts = json.map(row => ({
                        id: String(row.ID || Date.now().toString() + Math.random().toString(36).substring(2, 8)),
                        nome: String(row.Nome || 'Sem Nome'),
                        categoria: String(row.Categoria || 'Geral'),
                        descricao: String(row.Descricao || ''),
                        valor: parseFloat(row.Preco) || 0,
                        imagem: String(row.Imagem || 'https://via.placeholder.com/150'),
                        menu: String(row.Menu || 'produtos')
                    }));
                }

                produtosSalvos = newProducts;
                salvarProdutos();
                alert('Produtos carregados com sucesso!');
                document.getElementById('product-upload-form').style.display = 'none';
                fileInput.value = ''; // Limpa o input do arquivo
            };
            reader.readAsBinaryString(file);
        }

        function excluirTodosOsProdutos() {
            if (confirm("Tem certeza que deseja deletar TODOS os produtos? Esta ação é irreversível!")) {
                produtosSalvos = [];
                salvarProdutos();
                carregarProdutosSalvos(); // Recarrega para usar o JSON inicial
                alert("Todos os produtos foram deletados. O catálogo inicial será carregado novamente.");
            }
        }

        function saveCurrentHtml() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert("O arquivo HTML foi salvo como 'index.html'.");
        }

        function openProductDetailsModal(productId) {
            const product = produtosSalvos.find(p => p.id === productId);
            if (product) {
                document.getElementById('detail-image').src = product.imagem;
                document.getElementById('detail-image').alt = product.nome;
                document.getElementById('detail-name').textContent = product.nome;
                document.getElementById('detail-category').textContent = product.categoria;
                document.getElementById('detail-description').textContent = product.descricao;
                document.getElementById('detail-price').textContent = `R$ ${product.valor.toFixed(2)}`;
                document.querySelector('#product-details-modal button').dataset.productId = product.id;
                abrirModal('product-details-modal');
            } else {
                alert('Produto não encontrado.');
            }
        }

        function renderCategoryFilters() {
            const categoryFiltersDiv = document.getElementById('category-filters');
            if (!categoryFiltersDiv) return;

            // Coleta todas as categorias únicas (incluindo 'produtos' e 'ofertas' do campo 'menu')
            const categories = new Set();
            produtosSalvos.forEach(p => {
                if (p.categoria) categories.add(p.categoria);
                if (p.menu) categories.add(p.menu); // Adiciona 'produtos' e 'ofertas' como categorias filtráveis
            });
            
            categoryFiltersDiv.innerHTML = ''; // Limpa os botões existentes

            // Adiciona o botão "Todos"
            const allButton = document.createElement('button');
            allButton.textContent = 'Todos';
            allButton.className = 'active'; // Inicia com "Todos" ativo
            allButton.onclick = () => {
                document.querySelectorAll('.category-filter-buttons button').forEach(btn => btn.classList.remove('active'));
                allButton.classList.add('active');
                renderProducts('todos', document.getElementById('search-input').value);
            };
            categoryFiltersDiv.appendChild(allButton);

            // Adiciona botões para cada categoria única
            Array.from(categories).sort().forEach(category => {
                if (category && category !== 'produtos' && category !== 'ofertas') { // Evita duplicar 'produtos' e 'ofertas' se já estiverem no menu
                    const button = document.createElement('button');
                    button.textContent = category;
                    button.onclick = () => {
                        document.querySelectorAll('.category-filter-buttons button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        renderProducts(category, document.getElementById('search-input').value);
                    };
                    categoryFiltersDiv.appendChild(button);
                }
            });
        }

        function carregarProdutosSalvos() {
            const storedProducts = localStorage.getItem('produtosSalvos');
            if (storedProducts && JSON.parse(storedProducts).length > 0) {
                produtosSalvos = JSON.parse(storedProducts);
                console.log("Produtos carregados do localStorage.");
                renderProducts();
                renderAdminProductList();
                renderCategoryFilters();
            } else {
                console.log("localStorage vazio ou inválido. Carregando produtos do arquivo JSON padrão...");
                // Mude esta linha:
                // fetch('produtos_iniciais.json')
                // Para esta:
                fetch('/produtos_iniciais.json') // Adicione a barra inicial aqui
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro ao carregar produtos_iniciais.json: ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Ajuste o mapeamento para corresponder EXATAMENTE às chaves do seu JSON
                        // Com base no JSON que você me enviou, as chaves são: nome, valor, imagem_id, menu
                        produtosSalvos = data.map(row => ({
                            id: String(row.ID || Date.now().toString() + Math.random().toString(36).substring(2, 8)), // Se seu JSON não tem "ID", ele gerará um
                            nome: String(row.nome || 'Sem Nome'), // "nome" do JSON
                            categoria: String(row.categoria || 'Geral'), // Se seu JSON não tiver, use 'Geral'
                            descricao: String(row.descricao || ''), // Se seu JSON não tiver, use ''
                            valor: parseFloat(row.valor) || 0, // "valor" do JSON
                            imagem: String(row.imagem_id || 'https://via.placeholder.com/150'), // "imagem_id" do JSON
                            menu: String(row.menu || 'produtos') // "menu" do JSON
                        }));
                        salvarProdutos();
                        renderProducts();
                        renderAdminProductList();
                        renderCategoryFilters();
                        alert('Catálogo inicial carregado do arquivo JSON!');
                    })
                    .catch(error => {
                        console.error("Não foi possível carregar o arquivo produtos_iniciais.json:", error);
                        // Fallback para os produtos de exemplo caso o JSON falhe completamente
                        produtosSalvos = [
                            { id: '1', nome: 'Produto A', categoria: 'Categoria 1', descricao: 'Descrição do Produto A', valor: 10.50, imagem: 'https://via.placeholder.com/150', menu: 'produtos' },
                            { id: '2', nome: 'Produto B', categoria: 'Categoria 2', descricao: 'Descrição do Produto B', valor: 20.00, imagem: 'https://via.placeholder.com/150', menu: 'produtos' }
                        ];
                        salvarProdutos();
                        renderProducts();
                        renderAdminProductList();
                        renderCategoryFilters();
                    });
            }
        }


        window.onload = function() {
            localStorage.removeItem('isAdminLoggedIn'); // Limpa o login de admin ao carregar a página
            carregarProdutosSalvos();
            mostrarPainel('produtos');
            renderCart(); // Garante que o carrinho é renderizado ao carregar a página
        };
    </script>
</body>
</html>